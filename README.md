# too-much-talker-main-server

ê°œìš”
=============

ì“°ê¸° ë§‰ë§‰í•œ **ìê¸°ì†Œê°œì„œ**, ëˆ„ê°€ ëŒ€ì‹  ì¨ì¤€ë‹¤ë©´ ì–¼ë§ˆë‚˜ ì¢‹ì„ê¹Œìš”? ì•„ë‹ˆ, ì´ˆì•ˆì´ë¼ë„ ì‘ì„±í•´ì¤€ë‹¤ë©´ ë” ë°”ë„ê²ƒë„ ì—†ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ ë‹µë‹µí•¨ì„ í•´ê²°í•˜ê¸° ìœ„í•´ **Chat GPT**ë¥¼ ì´ìš©í•´ ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ GPTì—ê²Œ ê·¸ëƒ¥ ìê¸°ì†Œê°œì„œë¥¼ ì‘ì„±í•´ë‹¬ë¼ê³  í•˜ë©´ í•©ê²©í•  ìˆ˜ ìˆëŠ” ìê¸°ì†Œê°œì„œë¥¼ ì¨ì£¼ì§€ëŠ” ì•Šì£ . ê·¸ë˜ì„œ ì–´ë–»ê²Œ **í”„ë¡¬í¬íŠ¸**ë¥¼ ì‘ì„±í•´ì•¼ í• ì§€ ê³ ë¯¼í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì €í¬ì˜ ê³ ë¯¼ê³¼ ê²½í—˜ì„ **ì„œë¹„ìŠ¤**ë¡œ ë‹´ì•„ë‚´ì–´ ì—¬ëŸ¬ ì‚¬ëŒë“¤ì—ê²Œ **ê³µìœ **í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

ë³¸ í”„ë¡œì íŠ¸ëŠ” í¬ê²Œ ë‘ íŒŒíŠ¸ë¡œ ë‚˜ë‰˜ì–´ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ëŠ” ì„œë¹„ìŠ¤ êµ¬í˜„ì„ ìœ„í•œ ì‘ì—…ë“¤ì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” GPTì˜ ì„±ëŠ¥ì„ ê°œì„ í•˜ê¸° ìœ„í•œ í”„ë¡¬í¬íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì‘ì—…ë“¤ì…ë‹ˆë‹¤. ê° íŒŒíŠ¸ë³„ë¡œ ì–´ë–¤ ì‘ì—…ì´ ì´ë¤„ì¡ŒëŠ”ì§€ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ì•„ë˜ë¥¼ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. (í”„ë¡œì íŠ¸ ì¢…ë£Œ í›„ ì‘ì„± ì˜ˆì •)

ì‹œì—° ì˜ìƒ : https://youtu.be/KvNnh40It4s

**ğŸ–Šï¸ Language**

Typescript, HTML, Css, Tailwind Python

**ğŸ“š Library**

React, Typescript 
Python : langchain, â€¦

**ğŸ¦œ Members**

**ì›ê°€ì—°**, Back-End Developer, henzel1013@gmail.com  
**ì°¨ìœ ì§„**, Prompt Engineer, chaujin00@gmail.com  
**ê¸¸í•˜ê· **, Project Manager + Prompt Engineer, ghaguniv@gmail.com  
**ìµœìš©í˜„**, Front-End Developer, chldydgus777@kakao.com  


ì£¼ìš” í…ŒìŠ¤í¬ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
=============

### **í…ŒìŠ¤í¬ëª… :** API ëª…ì„¸ì„œ ì‘ì„±í•˜ê¸°


**í…ŒìŠ¤í¬ ì„¤ëª…**

- ì–´ë–¤ APIê°€ ìˆëŠ”ì§€ ë³¼ ìˆ˜ ìˆë„ë¡ API ëª…ì„¸ë¥¼ ì œê³µí•˜ê¸°.

**ê³ ë¯¼ or ì´ìŠˆ&í•´ê²°**

- ê¸°ì¡´ì˜ API ëª…ì„¸ ì‘ì„±ì€ ì´ëŸ°ì‹ìœ¼ë¡œ íŠ¹ì • APIì— ë”°ë¼ request ë°ì´í„°ì™€ returnê°’ìœ¼ë¡œ ì˜¤ëŠ” ë°ì´í„°ê°€ ë¬´ì—‡ì¸ì§€ ë¬¸ì„œë¡œ ì‘ì„±í•˜ì—¬ í”„ë¡ íŠ¸ê°œë°œìì™€ ì†Œí†µí•œë‹¤.

    ![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/dfe2ffa6-9d79-4d01-925c-7f069176ce25)

    
    ê·¸ëŸ°ë° ì´ ë°©ë²•ì˜ ê²½ìš° ì‹¤ì‹œê°„ìœ¼ë¡œ ìš”ì²­ì‚¬í•­ì´ ë°”ë€Œê±°ë‚˜ ì½”ë“œê°€ ë°”ë€ŒëŠ” ê²½ìš° ì¶”ì ì´ ë¶ˆê°€ëŠ¥í•˜ë©° 
    API ëª…ì„¸ë¥¼ ë´ì•¼í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„  í…ŒìŠ¤íŠ¸ë„ ëª»í•´ë³´ë‹ˆ ë¶ˆí¸í•¨ì´ ë§ë‹¤.
    
    ê·¸ë˜ì„œ ì„œë²„ Swaggerë¼ëŠ” API ëª…ì„¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì ìš©ì‹œí‚¨ë’¤
    
    ```jsx
    @Configuration
    @EnableSwagger2
    @EnableAsync
    @EnableWebMvc
    public class SwaggerConfiguration implements WebMvcConfigurer {
    
        @Override
        public void addResourceHandlers(ResourceHandlerRegistry registry) {
            registry.addResourceHandler("swagger-ui.html")
                    .addResourceLocations("classpath:/META-INF/resources/");
            registry.addResourceHandler("/webjars/**")
                    .addResourceLocations("classpath:/META-INF/resources/webjars/");
        }
    
        @Bean
        public Docket swagger() {
            return new Docket(DocumentationType.SWAGGER_2)
                    .select()
                    .apis(RequestHandlerSelectors.any())
                    .paths(PathSelectors.any())
                    .build();
        }
    }
    ```
    
    ê°ê°ì˜ API ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í•´ë‹¹ APIê°€ ì–´ë–¤ ì—­í• ì¸ì§€ ì½”ë“œë¡œ ì‘ì„±í•´ì£¼ë©´ ëœë‹¤.
    
    ```jsx
        @ApiOperation(value="ë¡œê·¸ì¸ API"
                , notes="í† í° ë¡œê·¸ì¸ì€ ì¶”í›„ êµ¬í˜„í•˜ëŠ”ê±¸ë¡œí•©ë‹ˆë‹¹. ì¼ë‹¨ì€ ë¸Œë¼ìš°ì €ì— ìœ ì €ì•„ì´ë””ê°’ ì €ì¥í•˜ëŠ”ê±¸ë¡œ" +
                ", ì¶”í›„ ìš”ì²­ì„ ë„ˆë¬´ ë§ì´ ë³´ë‚´ëŠ” ìœ ì €ëŠ” ë²¤ë¨¹ì´ê¸°ìœ„í•´ ìµœì´ˆ ë¡œê·¸ì¸ ipë„ ê°™ì´ë³´ë‚´ì£¼ì„¸ìš”"
                , response = LoginResponse.class)
        @PostMapping("/login")
        private ResponseEntity login(@Valid @RequestBody LoginRequest loginRequest){
            LoginResponse user = accountService.login(loginRequest);
            return new ResponseEntity(
                    user,
                    HttpStatus.OK
            );
        }
    ```
    
    ê·¸ëŸ¬ë©´ ìë™ìœ¼ë¡œ swagger configì—ì„œ @ApiOperationì„ ì‚¬ìš©í•˜ëŠ” APIë¥¼ ì¶”ì í•´ ì´ë ‡ê²Œ  ì›¹í˜ì´ì§€ì—ì„œ í…ŒìŠ¤íŠ¸í•´ì¤„ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ì œê³µí•œë‹¤. â†’ ì„œë²„ë¥¼ ì¼œë©´ í•´ë‹¹ swagger ì›¹í˜ì´ì§€ë„ ìƒì„±ë¨

  ![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/04969c68-616f-4b44-935f-f83b06f7612a)

    
    ì´ê±´ ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸í•´ë³¼ìˆ˜ìˆëŠ” ì£¼ì†Œë‹¤
    
    [http://43.202.47.122:8080/swagger-ui/#/ì‚¬ìš©ì ê³„ì • ê´€ë ¨ ê¸°ëŠ¥/loginUsingPOST](http://43.202.47.122:8080/swagger-ui/#/%EC%82%AC%EC%9A%A9%EC%9E%90%20%EA%B3%84%EC%A0%95%20%EA%B4%80%EB%A0%A8%20%EA%B8%B0%EB%8A%A5/loginUsingPOST)
    


### **í…ŒìŠ¤í¬ëª… :** Corsì—ëŸ¬ í•´ê²° ë’¤ Swagger ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶©ëŒ


**í…ŒìŠ¤í¬ ì„¤ëª…**

- cors ì˜¤ë¥˜ë¼ëŠ”ê²Œ ì¡´ì¬í•œë‹¤. ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ìë©´ í´ë¼ì´ì–¸íŠ¸ì˜ ì£¼ì†Œì™€ API ì„œë²„ ì£¼ì†Œê°€ ë‹¤ë¥´ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‹¤ë¥¸ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ë¼ê³  ìƒê°í•´ í•´ë‹¹ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ”ê±°ë‹¤.
ì¦‰, ì›¹ì„œë²„ë„ ë¦¬ì†ŒìŠ¤ì´ê¸°ì— ë‚´ê°€ ë°°í¬í•œ APIì„œë²„ë¥¼ í”„ë¡ íŠ¸ ì„œë²„ì—ì„œ ìš”ì²­í•˜ì§€ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

    ![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/6be9fb2a-f996-43d2-ad46-ce6cc124459c)

    

+) ì´ê±´ ì¶”ê°€ìë£Œ

[Cors ì˜¤ë¥˜ ì™œ ìƒê¸°ëŠ”ê±¸ê¹Œ?](https://lets-do-the-odessey.tistory.com/54)


**ê³ ë¯¼ or ì´ìŠˆ&í•´ê²°**

- GPTì˜ ì¡°ì–¸ì— ë”°ë¥´ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì„œë²„ì—ì„œ **Access-Control-Allow-Origin** ë¼ëŠ” í—¤ë”ê°’ë§Œ ì ì ˆíˆ ì œê³µí•˜ë©´ëë‹¤.
    
    ```jsx
    ê¸°ë³¸ì ìœ¼ë¡œ ì›¹ ë¸Œë¼ìš°ì €ëŠ” ê°™ì€ ì¶œì²˜ ì •ì±…(Same-Origin Policy)ì„ ë”°ë¦…ë‹ˆë‹¤. 
    ì´ ì •ì±…ì— ë”°ë¼, ì›¹ í˜ì´ì§€ëŠ” ê°™ì€ ë„ë©”ì¸ì—ì„œë§Œ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
    ì˜ˆë¥¼ ë“¤ì–´, https://example.comì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ https://example.comì˜ ë¦¬ì†ŒìŠ¤ë§Œ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë„ë©”ì¸(ì˜ˆ: https://another-domain.com)ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ë ¤ë©´, ê·¸ ë¦¬ì†ŒìŠ¤ê°€ CORS í—¤ë”ë¥¼ í†µí•´ ëª…ì‹œì ìœ¼ë¡œ ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.
    ```
    
    ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•œ Spring í”„ë ˆì„ì›Œí¬ëŠ” ì´ëŸ¬í•œ ê¸°ëŠ¥ì´ ì˜ ì„¸íŒ…ë˜ì–´ìˆì–´ì„œ ì¶”ê°€í•´ì¤¬ëŠ”ë°
    
    ```jsx
    @Configuration
    public class WebConfiguration implements WebMvcConfigurer {
        // Todo. ë‚˜ì¤‘ì— ë„ë©”ì¸ ìƒê¸°ë©´ ê·¸ë•ŒëŠ” ì¶œì²˜ ì œí•œí•˜ë„ë¡
    
        @Override
        public void addCorsMappings(CorsRegistry registry) {
            registry.addMapping("/**")//corsë¥¼ ì ìš©í•  URLíŒ¨í„´ ì •ì˜
                    .allowedOriginPatterns("*")//ìì› ê³µìœ  í—ˆë½í•  Origin í—ˆë½
                    .allowedMethods("*")//í—ˆë½í•  HTTP method ì§€ì •
                    .allowCredentials(true)
                    .allowedHeaders("*");
        }
    }
    ```
    
    ë¬¸ì œëŠ” ì´ê±¸ ì¶”ê°€í•˜ê³ ë‚˜ë‹ˆê¹Œ ìœ„ì—ì„œ ì œê³µí•œ API ëª…ì„¸ í˜ì´ì§€ê°€ ì˜¤ë¥˜ ë‚˜ë©´ì„œ ì•ˆëœ¨ëŠ”ê±°ë‹¤.
    
![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/6bd98619-b144-4026-9be0-05089220f2c1)


<aside>
âš ï¸ ìƒì„±ëœ ì—ëŸ¬ë©”ì„¸ì§€

Unable to infer base url. This is common when using dynamic servlet registration or when the API is behind an API Gateway. The base url is the root of where all the swagger resources are served. For e.g. if the api is available at http://example.org/api/v2/api-docs then the base url is http://example.org/api/. Please enter the location manually:

</aside>

í•´ë‹¹ ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ë”°ë¼ GPTì—ê²Œ ë¬¼ì–´ë³´ê±°ë‚˜ ë‚˜ì™€ ë˜‘ê°™ì€ ì—ëŸ¬ê°€ ë‚œ ì‚¬ëŒë“¤ì´ í•´ê²°í•œ ê²½ìš°ëŠ” ëŒ€ë¶€ë¶„

- Swagger ì„¤ì •ì— base URLì„ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ê°€
- Security ë¬¸ì œ(ì´ê±´ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì¶©ëŒì¸ ê²½ìš°)
- ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ë¦¬ ë²„ì „ì„ ë§ì¶”ì§€ ì•Šì€ ê²½ìš°

ê·¸ëŸ°ë° ìœ„ ì„¸ê°œ ë‹¤ í•´ë‹¹ë˜ì§€ì•ŠëŠ” ìƒí™©ì´ì—ˆë‹¤..

ê·¸ëŸ¬ë˜ ë„ì¤‘ êµ‰ì¥íˆ í—ˆë¬´í•˜ê²Œ.. ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¤‘ë³µì„¤ì¹˜ë˜ì–´ ì˜¤ë¥˜ê°€ ë‚¬ë˜ìƒí™©ì´ë€ê±¸ ê¹¨ë‹¬ì•˜ë‹¤.

ì„¤ëª…í•˜ìë©´ springfox:starter ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì•ˆì— swaggerì™€ swagger-uiê°€ í¬í•¨ë˜ì–´ìˆëŠ”ë° ì´ê±¸ ë”°ë¡œ ì„¤ì¹˜ë°›ì•„ ì˜¤ë¥˜ê°€ ë‚¬ë˜ê²ƒê°™ë‹¤.(ì •í™•íˆ ì™œ ì¶©ëŒì´ ë‚œê±´ì§„ ëª¨ë¥´ê² ìŒ..)

![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/e4430cb0-8b7e-4109-a7cc-76b25d0a6ec0)


### **í…ŒìŠ¤í¬ëª… :** gpt í”„ë¡¬í”„íŠ¸ ì½”ë“œë¥¼ APIë¡œ ë™ì‘í•˜ê²Œ í•˜ê¸°


**í…ŒìŠ¤í¬ ì„¤ëª…**

- ì´ ë¶€ë¶„ì´ ì œì¼ í˜ë“¤ì—ˆë˜ ë¶€ë¶„ì¸ë° ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ API ì„œë²„ì™€ GPTì— ìš”ì²­í•˜ëŠ” í”„ë¡¬í”„íŠ¸ ì„œë²„ê°€ ë”°ë¡œ ë‚˜ë‰˜ì–´ì ¸ìˆë‹¤.
ê·¸ë˜ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ê°œë°œí•˜ëŠ” ë¶„ 1ëª… APIì„œë²„(ìë°” ì„œë²„)ë¥¼ ê°œë°œí•˜ëŠ” ë‚˜ 1ëª… ì´ 2ëª…ì´ì„œ ë°±ì—”ë“œê°œë°œì„í–ˆëŠ”ë°,
í”„ë¡¬í”„íŠ¸ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ì½”ë“œë§Œ ì‘ì„±ë˜ì–´ìˆì—ˆê³  ì´ê±¸ ìë°”ì„œë²„ì—ì„œ ìš”ì²­ ê°€ëŠ¥í•˜ê²Œ API í˜•íƒœë¡œ ë§Œë“¤ì–´ì•¼í–ˆë‹¤.

![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/0cc2a10f-0f32-4ca9-9b54-59824c2293b4)


**ê³ ë¯¼ or ì´ìŠˆ&í•´ê²°**

- ì´ê²Œ api keyì™€ ì´ì „ì— ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ë¡œ í•©ì³ì§„ ë©”ì„¸ì§€ë¥¼ gptì—ê²Œ ìµœì¢… ìš”ì²­ ë³´ë‚´ëŠ” ì½”ë“œì¸ë° ì´ê²Œ ì˜ˆìƒëŒ€ë¡œ ë˜ì§€ì•Šì•„(ì˜ˆì™¸ì²˜ë¦¬ ë˜ì§€ì•ŠìŒ, ë””ì½”ë”© ë¬¸ì œ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ ë¬¸ì œë“±)

```python
def get_completion(openai_api_key, messages):
    '''
    ==============================================
    apië¡œ ìš”ì²­ ë³´ë‚´ê³  ë‹µë³€ ë°›ì•„ì˜¤ëŠ” í•¨ìˆ˜
    ::openai_api_key:: openai api key(ìœ ë£Œ) ì…ë ¥
    ::messages:: apië¡œ ì „ì†¡í•  system/user promptì…ë ¥
    ==============================================
    '''
    client = openai_api_key
    completion = client.chat.completions.create(
        model="gpt-4-1106-preview",
        messages=messages
    )
    return completion.choices[0].message
```

ì´ë ‡ê²Œ ê°™ì€ ë™ì‘ì„ í•˜ëŠ” version2 í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤.

```python
def get_completion_v2(messages):
    # Todo. ì¸ì½”ë”© ë¬¸ì œ í•´ê²°
    # OpenAI API í‚¤ ì„¤ì •
    openai.api_key = config.API_KEY

    # ChatCompletion í˜¸ì¶œ
    completion = openai.ChatCompletion.create(
        model="gpt-4-1106-preview",
        messages=messages
    )

    # ë°˜í™˜ëœ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜´
    message = completion
    message_jsonify = message.json()['choices'][0]['message']['content']

    # 'content' í•„ë“œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    if 'content' not in message:
        # 'content' í•„ë“œê°€ ì—†ëŠ” ê²½ìš° ì˜ˆì™¸ ë°œìƒ
        raise Exception("Content field is missing from the response.")

    # 'content' í•„ë“œê°€ ìˆëŠ” ê²½ìš°, í•´ë‹¹ ê°’ì„ ë””ì½”ë“œ
    print(message_jsonify)
    # decoded_content = message['content'].encode('utf-8').decode('unicode_escape')
    return message_jsonify
```

ë˜í•œ ìš°ë¦¬ëŠ” ë°ì´í„°ë¥¼ í…Œì´ë¸”ì—ì„œ êº¼ë‚¸ ë’¤ â†’ ë‹¤ì‹œ í•´ë‹¹ í…Œì´ë¸”ì— commití•´ì£¼ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼í–ˆê¸°ì—
ì´ë ‡ê²Œ user_idê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìœ¼ë©´ í•´ë‹¹ userê°€ ì§ˆë¬¸ì„ ì‘ì„±í–ˆì§€ë§Œ ë‹µë³€ë˜ì§€ì•Šì€ ì§ˆë¬¸ì´ ìˆëŠ”ì§€ ê²€ì‚¬ í›„,
í•´ë‹¹ ì§ˆë¬¸ì— ë”°ë¥¸ ìœ ì €ì˜ ì •ë³´ê°’ì„ ë“¤ê³  ì˜¨ ë’¤ ìœ„ì— ìˆëŠ” get_completion_v2ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ì„œë¹„ìŠ¤ë¡œì§ì„ ì‘ì„±í•´ì¤¬ë‹¤.

```python
def generate_job_application_responses(user_id):
    # UserJobApplicationInfo ì¡°íšŒ, ê°€ì¥ ìµœì‹ ê°’ í•œ ê°œë§Œ ì¡°íšŒ
    application_info = UserJobApplicationInfo.query.filter_by(user_id=user_id).order_by(
        UserJobApplicationInfo.created_at.desc()).first()

    if not application_info:
        raise ValueError("ìê¸°ì†Œê°œì„œ ì‘ì„± ìš”ì²­ì„ í•´ì£¼ì„¸ìš”.")

    unanswered_questions = JobApplicationQuestions.query.filter(
        JobApplicationQuestions.job_id == application_info.id,
        JobApplicationQuestions.answer == None
    ).all()

    if not unanswered_questions:
        raise ValueError("ëª¨ë“  ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")

    # ExperienceHistoryì™€ ExperienceDetails ì¡°íšŒ ë° ë§¤í•‘
    experience_histories = ExperienceHistory.query.filter(
        ExperienceHistory.resume_id == application_info.id
    ).all()

    experiences_info = []
    for history in experience_histories:
        details = ExperienceDetails.query.filter(
            ExperienceDetails.experience_id == history.id
        ).all()

        experience_info = {
            "institution_name": history.institution_name,
            "position": history.position,
            "start_date": history.start_date.strftime('%Y-%m-%d'),
            "end_date": history.end_date.strftime('%Y-%m-%d') if history.end_date else 'í˜„ì¬',
            "type": history.type,
            "description": [detail.description for detail in details],
            "skill_highlighted": [detail.skill_highlight for detail in details]
        }
        experiences_info.append(experience_info)

    # ì§ˆë¬¸ì— ëŒ€í•œ GPT ìš”ì²­ ë° ê²°ê³¼ ì²˜ë¦¬
    for question in unanswered_questions:
        # ê²½í—˜ ìš”ì•½ ìƒì„±
        experience_history = format_experiences_for_gpt(experiences_info)
        system_prompt_example = 'ì•„ë˜ì˜ ì§€ì›ì ì •ë³´ì™€ ê¸°ì—… ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìê¸°ì†Œê°œì„œ ì§ˆë¬¸ì— ë‹µë³€í•´ì¤˜. ë‹¨, ë§íˆ¬ëŠ” í‰ì„œë¬¸,ê²½ì–´ì²´ë¡œ ë¶€íƒí•´.'

        prompt_example = fill_info(
            company_name=application_info.company_name,
            job_title=application_info.job_title,
            job_description=application_info.job_description,
            qualification_requirements=application_info.qualification_requirements,
            question=question.question,
            experience_history=experience_history
        )

        print(" -- GPT ë‹µë³€ ìš”ì²­ --")
        answer = get_completion_v2(get_messages(system_prompt_example,prompt_example))
        print(" -- GPT ë‹µë³€ ë°›ìŒ --")

        # ë°›ì•„ì˜¨ ë‹µë³€ì„ JobApplicationQuestions ëª¨ë¸ì— ì €ì¥
        update_question_answer(question.id, answer)
```

### **í…ŒìŠ¤í¬ëª… :** íŒŒì´ì¬ ì„œë²„ë¡œ 1ì´ˆë§ˆë‹¤ userê°’ í™•ì¸í•˜ëŠ” ë°°ì¹˜ ë§Œë“¤ê¸°

---

**í…ŒìŠ¤í¬ ì„¤ëª…**

- ê·¸ë ‡ì§€ë§Œ ìë°”ë§Œ ì“°ë˜ ë‚˜ëŠ”.. íŒŒì´ì¬ ì„œë²„ê°€.. íŒŒì´ì¬ í”„ë¡œì íŠ¸ê°€.. ì´ë ‡ê²Œ ë§ì€ ìš©ëŸ‰ì„ ì°¨ì§€í•˜ëŠ”ì¤„ ëª°ëë‹¤. ì§€ê¸ˆê¹Œì§€ëŠ” AWSì—ì„œ ì œê³µí•˜ëŠ” ê³µì§œ ë©”ëª¨ë¦¬1ê¸°ê°€ í•˜ë“œ8ê¸°ê°€ì§œë¦¬ ê°€ìƒPCì— ë°°í¬í•´ì™”ë‹¤.


![image](https://github.com/gpt-web-project/too-much-talker-main-server/assets/57881683/def0aa6b-9f1b-4e32-8cde-87b3f4dff3c0)


ê·¸ëŸ°ë° íŒŒì´ì¬ì„¤ì¹˜í•˜ê³  ìš´ì˜ì²´ì œê°€ ê¹”ë ¤ìˆê³ ..ê·¸ëŸ¬ë‹ˆ ë¬´ë£Œë¡œ ì œê³µë˜ëŠ”  íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜ë°›ì„ìˆ˜ê°€ì—†ì—ˆë‹¤..

<aside>
âš ï¸ ec2 ì„œë²„ì— ëœ¬â€¦ ì—ëŸ¬ë©”ì„¸ì§€

INFO: pip is looking at multiple versions of transformers to determine which version is compatible with other requirements. This could take a while.
Collecting transformers
Using cached transformers-4.38.0-py3-none-any.whl (8.5 MB)
Using cached transformers-4.37.2-py3-none-any.whl (8.4 MB)
Downloading transformers-4.37.1-py3-none-any.whl (8.4 MB)
|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                         | 1.7 MB 4.4 MB/s eta 0:00:02ERROR: Could not install packages due to an OSError: [Errno 28] No space left on device

</aside>

**ê³ ë¯¼ or ì´ìŠˆ&í•´ê²°**

- ì•„ì§ í•´ê²°..ì¤‘ì´ë‹¤..^â€”^
